#!/usr/bin/perl

use warnings;
use strict;
use Mojolicious::Lite;
use File::Slurp;

get '/' => sub {
	my $self = shift;
	my $code = read_file($0);
	$self->stash('code' => $code);
	$self->render(template => 'showform');
};

post '/' => sub {
	my $self = shift;

	my $code = $self->param('code');
	$code =~ s/\r$//gm;
	write_file($0, { binmode => ':utf8', atomic => 1 }, $code);
	$self->redirect_to('/');

};


app->start;
__DATA__

@@ showform.html.ep
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
 
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
	<title>Skykitteh works!</title>
</head>
<body>
<form action="" method="post">
	<div style="display: block; padding: 4px">
		<textarea name="code" rows="46" style="font-family: monospace; width: 100%; height: 100%"><%= $code %></textarea>
	</div>
	<input type="submit" name="submit" value="Evolve!" />
</form>
</body>
</html>
